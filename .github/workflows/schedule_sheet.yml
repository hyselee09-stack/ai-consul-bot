name: ğŸ“Š Google Sheet Monitor Schedule

on:
  schedule:
    # ë§¤ì¼ í•œêµ­ ì‹œê°„ ì•„ì¹¨ 9ì‹œ (UTC 00:00)
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  run-sheet-monitor:
    runs-on: ubuntu-latest
    
    # ìºì‹œ ì„¤ì •ì„ ìœ„í•œ í™˜ê²½ë³€ìˆ˜
    env:
      R_LIBS_USER: ./R/library
      TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
      MY_CHAT_ID: ${{ secrets.MY_CHAT_ID }}

    steps:
      - uses: actions/checkout@v3
      - uses: r-lib/actions/setup-r@v2
      - uses: r-lib/actions/setup-pandoc@v2
      
      - name: Install Linux Deps
        run: |
          sudo apt-get update
          sudo apt-get install -y libcurl4-openssl-dev libssl-dev libxml2-dev
        
      - name: Cache R Packages
        uses: actions/cache@v3
        with:
          path: ${{ env.R_LIBS_USER }}
          key: ${{ runner.os }}-r-${{ hashFiles('.github/workflows/*.yml') }}
          restore-keys: |
            ${{ runner.os }}-r-

      - name: Install R Packages
        run: |
          dir.create(Sys.getenv("R_LIBS_USER"), recursive = TRUE, showWarnings = FALSE)
          # googlesheets4 íŒ¨í‚¤ì§€ ì¶”ê°€
          install.packages(c("rmarkdown", "pacman", "googlesheets4", "tidyverse", "telegram.bot", "lubridate", "stringr"), 
                           repos = "https://packagemanager.posit.co/cran/__linux__/jammy/latest", 
                           lib = Sys.getenv("R_LIBS_USER"))
        shell: Rscript {0}
        
      - name: Run Sheet Monitor
        run: Rscript -e "rmarkdown::render('travel_sheet_monitor.Rmd')"
